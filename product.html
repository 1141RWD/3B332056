
<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>商品詳情｜Maison Douce</title>
  <meta name="description" content="Maison Douce 法式精品甜點" />
  <link rel="icon" href="MD.ico">
  
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/shared.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;600&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
  
  <style>
    /* 頁面專屬樣式 */
    .detail-grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 4rem; align-items: start; margin-top: 1rem; }
    .detail-media { position: sticky; top: 100px; }
    .main-image { width: 100%; aspect-ratio: 1; background: #f8f8f8; object-fit: cover; border-radius: 4px; transition: transform 0.6s ease; }
    .main-image:hover { transform: scale(1.02); }
    
    .detail-info h1 { font-family: 'Noto Serif TC', serif; font-size: 2.25rem; margin-bottom: 0.5rem; color: var(--ink); line-height: 1.3; }
    .detail-price { font-size: 1.5rem; color: #1c1c1c; margin-bottom: 2rem; border-bottom: 1px solid #eee; padding-bottom: 1.5rem; font-weight: 500; }
    .detail-desc { margin-bottom: 2.5rem; line-height: 1.8; color: #555; font-size: 1.05rem; }
    
    /* 數量與按鈕佈局優化 */
    .action-row { display: flex; gap: 1rem; margin-bottom: 2rem; }
    .qty-selector { display: inline-flex; border: 1px solid #ddd; align-items: center; height: 50px; background: #fff; }
    .qty-selector button { width: 45px; height: 100%; background: none; border: none; cursor: pointer; font-size: 1.2rem; transition: background 0.2s; }
    .qty-selector button:hover { background: #f0f0f0; }
    .qty-selector input { width: 45px; height: 100%; border: none; text-align: center; font-size: 1rem; border-left: 1px solid #eee; border-right: 1px solid #eee; }
    
    .accordion { border-top: 1px solid #eee; margin-top: 3rem; }
    .acc-item { border-bottom: 1px solid #eee; }
    .acc-header { padding: 1.25rem 0; cursor: pointer; display: flex; justify-content: space-between; font-weight: 500; transition: color 0.3s; }
    .acc-header:hover { color: var(--gold, #b89f6b); }
    .acc-header::after { content: '+'; font-weight: 300; font-size: 1.2rem; }
    .acc-item.active .acc-header::after { content: '−'; }
    .acc-content { max-height: 0; overflow: hidden; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); color: #666; font-size: 0.95rem; line-height: 1.7; }
    .acc-item.active .acc-content { max-height: 300px; padding-bottom: 1.5rem; }

    /* 相關商品樣式補強 */
    .card .media { transition: transform 0.5s ease; }
    .card:hover .media { transform: translateY(-5px); }

    @media (max-width: 768px) {
      .detail-grid { grid-template-columns: 1fr; gap: 2rem; }
      .action-row { flex-direction: column; }
      .qty-selector { width: 100%; justify-content: space-between; }
      .qty-selector button { flex: 1; }
      .qty-selector input { flex: 1; }
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="container header-inner">
      <a class="brand" href="index.html">
        <div class="brand-mark"><span>MD</span></div>
        <div class="brand-text"><strong>MAISON DOUCE</strong><small>PARIS • TAIPEI</small></div>
      </a>
      <nav class="nav" aria-label="主選單">
        <a href="categories.html">商品系列</a>
        <a href="featured.html">精選商品</a>
        <a href="story.html">職人精神</a>
        <a href="b2b.html?tab=corp">企業專區</a>
        <a href="contact.html">聯絡我們</a>
      </nav>
      <div class="tools">
        <button class="iconbtn" id="btnSearch"><svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.8"/><path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg></button>
        <button class="iconbtn" onclick="toggleCart()" title="購物車">
          <svg class="icon" viewBox="0 0 24 24" fill="none">
            <circle cx="9" cy="21" r="1" stroke="currentColor" stroke-width="1.8"/>
            <circle cx="20" cy="21" r="1" stroke="currentColor" stroke-width="1.8"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <section class="section" style="min-height: 80vh; padding-top: 120px;">
    <div class="container" id="productDetail">
      <div style="text-align: center; padding: 100px; color: #999;">正在為您準備甜點資訊...</div>
    </div>
  </section>

  <div class="divider"></div>

  <section class="section">
    <div class="container">
      <h3 style="font-family: 'Noto Serif TC'; margin-bottom: 2.5rem; text-align: center; letter-spacing: 2px;">您可能也喜歡</h3>
      <div class="grid" id="relatedGrid"></div>
    </div>
  </section>

  <footer>
    <div class="container">
      <div class="footer-grid reveal">
        <div>
          <h4>Maison Douce</h4>
          <div style="color:rgba(28,28,28,.68); max-width:52ch;">法式精品甜點品牌，專注於風味層次與製作節奏。</div>
        </div>
        <div>
          <h4>商品系列</h4>
          <a href="featured.html?cat=macaron">馬卡龍</a>
          <a href="featured.html?cat=chocolate">巧克力</a>
          <a href="featured.html?cat=pastry">酥點</a>
          <a href="featured.html?cat=cake">蛋糕</a>
        </div>
        <div>
          <h4>品牌資訊</h4>
          <a href="story.html">職人精神</a>
          <a href="journal.html">品牌日誌</a>
          <a href="locations.html">門市資訊</a>
        </div>
        <div>
          <h4>聯絡我們</h4>
          <a href="b2b.html?tab=corp">企業專區</a>
          <a href="contact.html">聯絡方式</a>
        </div>
      </div>
      <div class="copyright"><span>© 2025 Maison Douce</span></div>
    </div>
  </footer>

  <div class="cart-overlay" id="cartOverlay" onclick="toggleCart()"></div>
  <div class="cart-drawer" id="cartDrawer">
    <div class="cart-header">
      <h3>購物袋</h3>
      <button class="close-drawer" onclick="toggleCart()">✕</button>
    </div>
    <div class="cart-body" id="cartItems">
      <p style="color: #666; text-align: center; margin-top: 2rem;">您的購物袋目前是空的。</p>
    </div>
    <div class="cart-footer">
      <button class="btn primary" style="width: 100%;" onclick="window.location.href='checkout.html'">前往結帳</button>
    </div>
  </div>

  <script src="js/data.js"></script>
  <script src="js/main.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');
      const container = document.getElementById('productDetail');

      // 1. 取得商品資料
      let product = null;
      if (typeof products !== 'undefined') {
        product = products.find(p => String(p.id) === id) || products[0];
      }

      if (!product) {
        container.innerHTML = '<div style="text-align:center; padding:100px;">找不到商品</div>';
        return;
      }

      // 2. 渲染商品詳情 (加入 action-row 優化佈局)
      container.innerHTML = `
        <div style="font-size:0.85rem; color:#aaa; margin-bottom:2.5rem; letter-spacing: 1px;">
          <a href="index.html" style="color:#666">HOME</a> <span style="margin:0 8px">/</span> 
          <a href="categories.html" style="color:#666">COLLECTION</a> <span style="margin:0 8px">/</span> 
          <span style="color:#1c1c1c">${product.name.toUpperCase()}</span>
        </div>
        
        <div class="detail-grid">
          <div class="detail-media">
            <img src="${product.image}" class="main-image" alt="${product.name}">
          </div>

          <div class="detail-info">
            <h1>${product.name}</h1>
            <div class="detail-price">${product.price}</div>
            <div class="detail-desc">${product.desc || '由主廚每日現作的法式風味，選用最頂級的進口食材，為您呈現純粹的甜點藝術。'}</div>

            <div class="action-row">
              <div class="qty-selector">
                <button onclick="updateQty(-1)">−</button>
                <input type="text" id="qtyInput" value="1" readonly>
                <button onclick="updateQty(1)">+</button>
              </div>
              <button class="btn primary" style="flex:1; height:50px;" onclick="handleAddToCart('${product.id}')">加入購物袋</button>
            </div>

            <div class="accordion">
              <div class="acc-item active">
                <div class="acc-header" onclick="this.parentElement.classList.toggle('active')">風味細節</div>
                <div class="acc-content">
                  ${product.flavor_info || '嚴選法國 AOP 認證奶油與高品質杏仁粉。每一口都能感受到分明的層次感與細膩的甜味平衡。'}
                </div>
              </div>
              <div class="acc-item">
                <div class="acc-header" onclick="this.parentElement.classList.toggle('active')">賞味與保存</div>
                <div class="acc-content">
                  ${product.storage_info || '建議冷藏保存並於 3 日內食用完畢以獲得最佳風味。從冷藏取出後室溫放置 10 分鐘，口感更佳。'}
                </div>
              </div>
            </div>
          </div>
        </div>
      `;

      // 3. 渲染相關商品
      renderRelated(product);
    });

    // 數量控制
    function updateQty(change) {
      const input = document.getElementById('qtyInput');
      let val = parseInt(input.value) + change;
      if (val < 1) val = 1;
      input.value = val;
    }

    // 加入購物車並開關側欄
    function handleAddToCart(productId) {
      const qty = parseInt(document.getElementById('qtyInput').value);
      if (window.addToCart) {
        // 如果你的 main.js addToCart 支援數量參數，可以傳入
        window.addToCart(productId, qty); 
        
        // 視覺回饋
        const btn = event.target;
        const originalText = btn.innerText;
        btn.innerText = '已加入購物袋';
        setTimeout(() => {
          btn.innerText = originalText;
          if(window.toggleCart) toggleCart(); // 自動打開購物車
        }, 600);
      }
    }

    // 隨機渲染 9 個相關商品
    function renderRelated(currentProduct) {
      const grid = document.getElementById('relatedGrid');
      if (!grid || typeof products === 'undefined') return;
      
      // 優化：優先顯示同分類商品 (Related Products)
      const sameCat = products
        .filter(p => p.cat === currentProduct.cat && String(p.id) !== String(currentProduct.id))
        .sort(() => 0.5 - Math.random());

      const others = products
        .filter(p => p.cat !== currentProduct.cat)
        .sort(() => 0.5 - Math.random());

      // 合併列表：優先取同分類，不足則由其他分類補齊，最後取前 9 筆
      const related = [...sameCat, ...others]
        .slice(0, 9);

      grid.innerHTML = related.map(p => `
        <div class="card">
          <a href="product.html?id=${p.id}" class="media" style="background-image:url('${p.image}'); background-size: cover; background-position: center; display: block;"></a>
          <div class="pad">
            <h3 style="font-size: 1rem; margin-bottom: 0.5rem;">${p.name}</h3>
            <div class="row" style="display: flex; justify-content: space-between; align-items: center;">
              <span class="price" style="color: #666;">${p.price}</span>
            </div>
          </div>
        </div>
      `).join("");
    }

    
  </script>
</body>
</html>