<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>商品詳情｜Maison Douce</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;600&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    /* 簡單的商品詳情頁樣式 */
    .product-detail-section {
      padding-top: 140px; /* 避開 Header */
      padding-bottom: 80px;
      min-height: 80vh;
    }
    .detail-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      align-items: start;
    }
    .detail-media img {
      width: 100%;
      height: auto;
      border-radius: 4px;
      display: block;
    }
    .detail-info h1 {
      margin-bottom: 1rem;
      font-family: 'Noto Serif TC', serif;
    }
    .detail-price {
      font-size: 1.5rem;
      font-weight: 500;
      color: var(--ink);
      margin-bottom: 2rem;
    }
    .detail-desc {
      margin-bottom: 2.5rem;
      line-height: 1.8;
      color: rgba(28,28,28,0.8);
    }
    .detail-actions {
      display: flex;
      gap: 1rem;
    }
    @media (max-width: 768px) {
      .detail-grid { grid-template-columns: 1fr; gap: 2rem; }
      .product-detail-section { padding-top: 100px; }
      .header-inner { flex-direction: column; height: auto; padding: 1rem; gap: 1rem; }
      .nav { gap: 1rem; flex-wrap: wrap; justify-content: center; }
    }
    /* 購物車側邊欄樣式 */
    .cart-drawer { position: fixed; top: 0; right: -400px; width: 100%; max-width: 400px; height: 100vh; background: #fff; z-index: 2000; box-shadow: -2px 0 10px rgba(0,0,0,0.1); transition: right 0.3s ease; display: flex; flex-direction: column; }
    .cart-drawer.open { right: 0; }
    .cart-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1999; opacity: 0; visibility: hidden; transition: opacity 0.3s ease; }
    .cart-overlay.open { opacity: 1; visibility: visible; }
    .cart-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
    .cart-body { flex: 1; padding: 20px; overflow-y: auto; }
    .cart-footer { padding: 20px; border-top: 1px solid #eee; }
    .close-drawer { background: none; border: none; font-size: 1.5rem; cursor: pointer; }
  </style>
</head>
<body>
  <!-- Header (引用與 index.html 相同的 Header 結構) -->
  <div class="header">
    <div class="container header-inner">
      <a class="brand" href="index.html">
        <div class="brand-mark"><span>MD</span></div>
        <div class="brand-text"><strong>MAISON DOUCE</strong><small>PARIS • TAIPEI</small></div>
      </a>
      <nav class="nav">
        <a href="categories.html">商品系列</a>
        <a href="featured.html">精選商品</a>
        <a href="story.html">職人精神</a>
        <a href="index.html#contact">聯絡我們</a>
      </nav>
      <div class="tools">
        <button class="iconbtn" onclick="history.back()" title="返回"><svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M19 12H5m7-7-7 7 7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      </div>
    </div>
  </div>

  <!-- Product Detail -->
  <section class="section product-detail-section">
    <div class="container">
      <div id="productDetail">
        <p>正在載入商品...</p>
      </div>
    </div>
  </section>

  <!-- Cart Drawer -->
  <div class="cart-overlay" id="cartOverlay"></div>
  <div class="cart-drawer" id="cartDrawer">
    <div class="cart-header">
      <h3>購物車</h3>
      <button class="close-drawer" id="closeCart">✕</button>
    </div>
    <div class="cart-body">
      <p style="color: #666; text-align: center; margin-top: 2rem;">您的購物車目前是空的。</p>
    </div>
    <div class="cart-footer">
      <button class="btn primary" style="width: 100%;">前往結帳</button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/data.js"></script>
  <script src="js/main.js"></script>
  <script>
// ================================
// 商品詳情頁渲染 (補上這段)
// ================================
function renderProduct() {
  const container = document.getElementById('productDetail');
  if (!container) return;

  // 1. 取得網址參數 ?id=...
  const params = new URLSearchParams(window.location.search);
  const idParam = params.get('id');

  if (!idParam) {
    container.innerHTML = '<p>未指定商品 ID</p>';
    return;
  }

  // 2. 比對資料 (products 來自 data.js)
  const productId = idParam;
  // 確保 products 存在
  if (typeof products === 'undefined') {
    container.innerHTML = '<p>無法讀取商品資料 (data.js 未載入)</p>';
    return;
  }
  
  const product = products.find(p => p.id === productId);

  if (!product) {
    container.innerHTML = '<p>找不到此商品</p>';
    return;
  }

  // 3. 生成 HTML
  container.innerHTML = `
    <div class="detail-grid">
      <div class="detail-media">
        <img src="${product.image}" alt="${product.name}">
      </div>
      <div class="detail-info">
        <h1>${product.name}</h1>
        <div class="detail-price">${product.price}</div>
        <div class="detail-desc">${product.desc || '暫無描述'}</div>
        <div class="detail-actions">
          <button class="btn primary" id="btnAddToCart">加入購物袋</button>
          <button class="btn" onclick="history.back()">繼續購物</button>
        </div>
      </div>
    </div>
  `;

  // 4. 綁定加入購物車按鈕事件
  const btnAdd = document.getElementById('btnAddToCart');
  if (btnAdd) {
    btnAdd.addEventListener('click', () => {
      if (window.addToCart) window.addToCart(product.id);

      // 按鈕回饋：顯示「已加入成功」
      const originalText = btnAdd.innerText;
      btnAdd.innerText = '已加入成功';
      setTimeout(() => {
        btnAdd.innerText = originalText;
      }, 1000);
    });
  }
}

// ================================
// 頁面載入同步
// ================================
document.addEventListener('DOMContentLoaded', () => {
  // renderCart();  // 不需要手動呼叫，main.js 載入時會自動執行一次
  renderProduct();  // 渲染商品詳情

  // 綁定關閉購物車功能
  const closeBtn = document.getElementById('closeCart');
  const overlay = document.getElementById('cartOverlay');
  const drawer = document.getElementById('cartDrawer');
  
  function closeCart() {
    if(drawer) drawer.classList.remove('open');
    if(overlay) overlay.classList.remove('open');
  }
  
  if(closeBtn) closeBtn.addEventListener('click', closeCart);
  if(overlay) overlay.addEventListener('click', closeCart);
});

  </script>
</body>
</html>